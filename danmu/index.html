<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
<title>jQuery弹幕插件</title>
  <!-- CSS  -->
<link href="materialize/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>

<!-- 语法高亮 -->
<link rel="stylesheet" href="highlight/styles/monokai.css">
<script src="highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!-- 语法高亮结束 -->

<!-- danmu -->
<script src="http://cdn.bootcss.com/jquery/2.1.3/jquery.js"></script>
<script src="danmu/jquery.plugin.js"></script>
<script src="danmu/jquery.timer.js"></script>
<script src="danmu/jquery.pause.js"></script>
<script src="danmu/jquery.danmu.js"></script>
<!-- danmu over -->

 <script  src="materialize/js/materialize.js"></script>
  <style type="text/css">
  body {
    font-family: "Microsoft YaHei" ! important;
      }
  </style>
</head>

<body>
  <ul id="dropdown1" class="dropdown-content">
    <li><a target="_blank" href="http://weibo.com/u/3911382082/">微博</a></li>
    <li><a target="_blank" href="http://www.wooyun.org/whitehats/秋风落木">乌云</a></li>
    <li class="divider"></li>
    <li><a target="_blank" href="http://space.bilibili.com/5591810">BiliBili</a></li>
    <li class="divider"></li>
    <li><a target="_blank" href="Mailto:root@liyawei.cn">给我发邮件</a></li>
</ul>
        <nav class="light-blue lighten-1" role="navigation">
    <div class="container">
      <div class="nav-wrapper"><a id="logo-container" href="http://www.liyawei.cn" target="_blank" class="brand-logo">AcGit</a>
        <ul class="right">
          <li><a class="dropdown-button" href="#!" data-activates="dropdown1">联系我<i class="mdi-navigation-arrow-drop-down right"></i></a></li>
        </ul>

        <ul id="nav-mobile" class="side-nav">
          <li><a class="dropdown-button" href="#!" data-activates="dropdown1">联系我<i class="mdi-navigation-arrow-drop-down right"></i></a></li>
        </ul>
        <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="mdi-navigation-menu"></i></a>
      </div>
    </div>
  </nav>
  <div class="section no-pad-bot" id="index-banner">
    <div class="container">
      <br><br>
      <h1 class="header center orange-text">jQuery弹幕插件</h1>
      <div class="row center">
        <h5 class="header col s12 light">帮你快速在网页上实现弹幕功能</h5>
      </div>
      <div class="row center">
        <a href="https://github.com/chiruom/danmu" target="_blank" class="btn-large waves-effect waves-light orange">View On Github</a>
      </div>
      <br><br>

    </div>
  </div>

  <div class="container">
        <div class="section">

      <!--   Icon Section   -->
      <div class="row">
        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center light-blue-text"><i class="mdi-action-extension"></i></h2>
            <h5 class="center">完备的功能</h5>

            <p class="light">彩色弹幕、顶端底端弹幕、自定义弹幕速度、实时调整透明度等弹幕该具备的基本功能，私都有提供。</p>
          </div>
        </div>

        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center light-blue-text"><i class="mdi-device-now-widgets"></i></h2>
            <h5 class="center">灵活的应用</h5>

            <p class="light">你可以给video加上与之时间线同步的弹幕，也可以把弹幕放在网页的其他任何地方，只要你觉得酷炫。</p>
          </div>
        </div>

        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center light-blue-text"><i class="mdi-action-favorite"></i></h2>
            <h5 class="center">竭诚的帮助</h5>

            <p class="light">如果你发现什么bug，或遇到什么问题，可以通过页面右上角联系我，私会尽自己的微薄之力。</p>
          </div>
        </div>
      </div>

    </div>
    <br><br>
    <div class="section">
      <div class="row">
        <div class="col s12 ">  
        <h4 class="center  orange-text"><i class="mdi-action-description "></i> 文档</h4>   
            <h5 >简介</h5>
            <p>
            本插件实现弹幕功能，就如某些视频网站上的弹幕功能一样，只不过国内大多数视频网站是用flash实现的，而私是通过jQuery来实现的。
             <br>就如绝大多数视频网站的弹幕功能，私也有彩色弹幕，顶端弹幕及底端弹幕等流行功能，也可以即时操控弹幕透明度。当然咯，也可以在弹幕运行的过程中暂停和继续，和html5 video标签时间线保持同步。
             <br>欣赏一个例子：
            </p>
            <div>
              <video id="v" src="http://liyawei-acgit.stor.sinaapp.com/shsn.mp4" width="800" height="480" controls="controls" >
              </video>

              <div id="danmu" onclick="play()">
              </div>
            </div> 
            <div>
                
                发弹幕:               
              <select  name="color" id="color" >
              <option value="white">白色</option>
              <option value="red">红色</option>
              <option value="green">绿色</option>
              <option value="blue">蓝色</option>
              <option value="yellow">黄色</option>
              </select>
              <select name="size" id="size" >
              <option value="0">小文字</option>
              <option value="1">大文字</option>
              </select>            
              <select name="position" id="position"   >
              <option value="0">滚动</option>
              <option value="1">顶端</option>
              <option value="2">底端</option>
              </select>         
          <input type="textarea" id="text" max=300 />    
           <button type="button"  onclick="send()">发送</button>
          
              弹幕显示:
                               <select  name="op" id="op"  onchange="op()" >
              <option value="1">透明度1</option>
              <option value="0.8">透明度0.8</option>
              <option value="0.6">透明度0.6</option>
              <option value="0.4">透明度0.4</option>
              </select> 
          
            
            </div>
            <h5> 用法</h5>
            <p>
              <ol>
            <li>不用多说，第一步要引入js文件，因为本插件依赖于jquery.plugin、jquery.timer、jquery.pause。所以要把它们和jQuery还有jquery.danmu.js一起引用。
<pre><code class="language-html">&lt;script src=&quot;danmu/jquery-1.11.1.min.js&quot;&gt;&lt;/script&gt; 
&lt;script src=&quot;danmu/jquery.plugin.js&quot;&gt;&lt;/script&gt; 
&lt;script  src=&quot;danmu/jquery.timer.js&quot;&gt;&lt;/script&gt; 
&lt;script  src=&quot;danmu/jquery.pause.js&quot;&gt;&lt;/script&gt;
&lt;script  src=&quot;danmu/jquery.danmu.js&quot;&gt;&lt;/script&gt;</code></pre>
            </li>
            <li>
              插件中定义了弹幕对象，意指具体某一条弹幕及起信息，对象名字叫”danmu”,该对象有如下属性：<br> 
              text——弹幕文本内容。 <br>
              color——弹幕颜色。 position——弹幕位置 “0”为滚动 “1” 为顶部 “2”为底部 <br>
              size——弹幕文字大小。 “0”为小字 ”1”为大字<br> 
              time——弹幕所出现的时间。 单位为”分秒“（及1/10秒，100毫秒）<br>
               例如：
               <pre><code class="language-js"> var a_danmu={ &quot;text&quot;:&quot;2333333&quot; , &quot;color&quot;:&quot;green&quot; ,&quot;size&quot;:&quot;1&quot;,&quot;position&quot;:&quot;0&quot;,&quot;time&quot;:60}; </code></pre>
               另外，为提高效率，插件另外定义了一种名为danmuss的对象，意指所有弹幕的集合，这个对象在每个弹幕屏中是唯一的。插件在运行时会把每个danmu对象写入danmuss对象，然后在相应的时间把某条弹幕放映于屏幕。dammuss对象每个属性的名称为弹幕所出现的时间点(分秒)，属性值为该时间点所出现的所有弹幕的danmu对象(没有time属性)所组成的数组。<br>
               例如： 
<pre><code class="language-js">var danmuss={ 1:[ { &quot;text&quot;:&quot;hahahaha&quot; , &quot;color&quot;:&quot;red&quot; ,&quot;size&quot;:&quot;0&quot;,&quot;position&quot;:&quot;0&quot;}, <br>{ &quot;text&quot;:&quot;233333&quot; , &quot;color&quot;:&quot;red&quot; ,&quot;size&quot;:&quot;0&quot;,&quot;position&quot;:&quot;2&quot;} ],<br> 3:[ { &quot;text&quot;:&quot;poi&quot; , &quot;color&quot;:&quot;red&quot; ,&quot;size&quot;:&quot;1&quot;,&quot;position&quot;:&quot;1&quot;}, <br>{ &quot;text&quot;:&quot;2333&quot; , &quot;color&quot;:&quot;#FFFFFF&quot; ,&quot;size&quot;:&quot;0&quot;,&quot;position&quot;:&quot;0&quot;} ],<br> 50:[ { &quot;text&quot;:&quot;XXX真好&quot; , &quot;color&quot;:&quot;#FFFFFF&quot; ,&quot;size&quot;:&quot;0&quot;,&quot;position&quot;:&quot;2&quot;}, ] };</code></pre> 
            </li>
            <li>
            要在屏幕中插入弹幕，首先需要划定一个区域，使用&lt;div&gt;。 <br>例如现在创建一个id=”danmu”的div作为弹幕将要飞过的区域 &lt;div id=&quot;danmu&quot;&gt; &lt;/div&gt; <br>然后调用插件方法，传递配置属性。<br>
<pre><code class="language-js">
(&quot;#danmu&quot;).danmu({
left: 0, //区域的左边边界位置，相对于父div 
top: 0 , //区域的上边边界位置，相对于父div 
height: 360, //区域的高度 width: 640, //区域的宽度 
zindex :100, //div的css样式zindex
speed:5000, //弹幕速度，飞过区域的毫秒数 
sumtime:900 , //弹幕运行总时间
danmuss:{}, //danmuss对象，运行时的弹幕内容 
default_font_color:&quot;#FFFFFF&quot;, //弹幕默认字体颜色 
font_size_small:24, //小号弹幕的字体大小,注意此属性值只能是整数
font_size_big:28, //大号弹幕的字体大小 
opacity:&quot;0.7&quot;, //弹幕默认透明度 
top_botton_danmu_time:4000 //顶端底端弹幕持续时间 } );</code></pre> 
所有属性都不是必须指定，默认值就如上。<br>
当不指定danmuss时，也可以在调用此方法后用
<pre><code class="language-js">$('#danmu').danmu(&quot;add_danmu&quot;,新弹幕的danmu类型对象)</code></pre>
;逐一添加danmu对象。 <br>
当然在弹幕运行的过程中，可以随时用 <pre><code class="language-js">$('#danmu').danmu(&quot;add_danmu&quot;,新弹幕的danmu类型对象) </code></pre>添加弹幕。 <br>
<br> 
</li>
<li>
做完以上准备后，可以使弹幕在该区域开始运行，调用<pre><code class="language-js">$('#danmu').danmu('danmu_start'); </code></pre>即可运行。<br> 
</li>
<li>
其他方法：<br> 暂停弹幕：<pre><code class="language-js">$('#danmu').danmu('danmu_pause'); </code></pre> 
暂停后继续：<pre><code class="language-js">$('#danmu').danmu('danmu_resume'); </code></pre>
停止弹幕：<pre><code class="language-js">$('#danmu').danmu('danmu_stop');  </code></pre>
即时增加弹幕：<pre><code class="language-js">$('#danmu').danmu(&quot;add_danmu&quot;,新弹幕的danmu类型对象); </code></pre>使弹幕时间同步与视频的时间，可能需要和时间相关的方法，如下。<br>
获取弹幕运行的当前时间(单位为分秒)：<pre><code class="language-js">$('#danmu').data(&quot;nowtime&quot;); </code></pre> 
设置弹幕运行的当前时间(单位为分秒)：<pre><code class="language-js">$('#danmu').data(&quot;nowtime&quot;，新时间)  </code></pre> 
更改弹幕透明度：<pre><code class="language-js">$(#danmu).data(&quot;opacity&quot;,新透明度数值);</code></pre> 是否处于暂停状态：<pre><code class="language-js">$('#danmu').data("paused");</code></pre>
<br>如果需要像视频网站那样使用户所发弹幕得以保存，需要使用到web后端及数据库技术。

</li>
</ol>
<h5>Demo</h5>
<p>这个网页的源代码中就包含了一个Demo，这个Demo做到了与Html5 video标签的结合。</p> 
        </div>
      </div>
    </div>
  </div>

   <footer class="page-footer orange">
    <div class="container">
      <div class="row">
        <div class="col  s12">
          <h5 class="white-text">Ruiko Li</h5>
          <p class="grey-text text-lighten-4">我是成都某985高校一应届毕业生，喜欢Web前端开发，Web前端安全；也喜欢Python和Linux。<br>我即将毕业，很想找一个靠谱的团队献上我的灵魂。如果你可以帮助我，请和我联系：root@liyawei.cn</p>


        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      @AcGit
      </div>
    </div>
  </footer>
      <!--Import jQuery before materialize.js-->
    <!--   // <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script> -->

 <script>
(function(){
$("#danmu").danmu({
    left: document.getElementById('v').offsetLeft ,
    top:   document.getElementById('v').offsetTop,
    height: 460,
    width: 800,
    zindex :100,
    speed:30000,
    opacity:1,
    font_size_small:26,
    font_size_big:28,
      top_botton_danmu_time:6000
}
  );
})(jQuery);

$(document).ready(function(){
  $(".dropdown-button").dropdown({ hover: false } ); //导航条菜单相关
query();
timedCount();

});
var first=true;
//这里让video和弹幕插件的时间线保持重合了
function timedCount()
{
 if (v.paused){
      $('#danmu').danmu('danmu_pause');
     }
  else {
  if($('#danmu').data("paused")){
    $('#danmu').danmu('danmu_resume');
  
  } 
 }
 if (Math.abs($('#danmu').data("nowtime")-parseInt(v.currentTime*10))>10){

   $('#danmu').data("nowtime",parseInt(v.currentTime*10));
 }

 
t=setTimeout("timedCount()",50)

}

function play(){
if (v.paused){
   v.play();
}
else {
  v.pause();  
} 


}

function starter(){
  document.getElementById("v").play();
  $('#danmu').danmu('danmu_start');

}
function pauser(){
  document.getElementById("v").pause();
  $('#danmu').danmu('danmu_pause');
}
function resumer(){
  document.getElementById("v").play();
  $('#danmu').danmu('danmu_resume');
}
function stoper(){
  $('#danmu').danmu('danmu_stop');
}

function getime(){
  alert($('#danmu').data("nowtime"));
}

function getpaused(){
  alert($('#danmu').data("paused"));
}

function add(){
var newd=
{ "text":"new2" , "color":"green" ,"size":"1","position":"0","time":60};

  $('#danmu').danmu("add_danmu",newd);
}
function insert(){
  var newd= { "text":"new2" , "color":"green" ,"size":"1","position":"0","time":50};
  str_newd=JSON.stringify(newd);
  $.post("stone.php",{danmu:str_newd},function(data,status){alert(data)});
}
function query() {
  $.get("query.php",function(data,status){
     var danmu_from_sql=eval(data);   
     for (var i=0;i<danmu_from_sql.length;i++){
      var danmu_ls=eval('('+danmu_from_sql[i]+')');
      $('#danmu').danmu("add_danmu",danmu_ls);
     }
  });
}

function send(){
  var text = document.getElementById('text').value;
  var color = document.getElementById('color').value;
  var position = document.getElementById('position').value;
  var time = $('#danmu').data("nowtime")+5;
  var text_obj='{ "text":"'+text+'","color":"'+color+'","size":"'+size+'","position":"'+position+'","time":'+time+'}';
  $.post("stone.php",{danmu:text_obj});
  var new_obj=eval('('+text_obj+')');
  $('#danmu').danmu("add_danmu",new_obj);
  document.getElementById('text').value='';
}

function op(){
var op=document.getElementById('op').value;
 $('#danmu').data("opacity",op);
}
</script>
</body>
</html>